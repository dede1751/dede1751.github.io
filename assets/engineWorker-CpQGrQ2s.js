(function(){"use strict";let _;function F(e){const t=_.__externref_table_alloc();return _.__wbindgen_export_2.set(t,e),t}function w(e,t){try{return e.apply(this,t)}catch(n){const r=F(n);_.__wbindgen_exn_store(r)}}const T=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&T.decode();let u=null;function d(){return(u===null||u.byteLength===0)&&(u=new Uint8Array(_.memory.buffer)),u}function c(e,t){return e=e>>>0,T.decode(d().subarray(e,e+t))}let a=0;const l=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},z=typeof l.encodeInto=="function"?function(e,t){return l.encodeInto(e,t)}:function(e,t){const n=l.encode(e);return t.set(n),{read:e.length,written:n.length}};function b(e,t,n){if(n===void 0){const o=l.encode(e),p=t(o.length,1)>>>0;return d().subarray(p,p+o.length).set(o),a=o.length,p}let r=e.length,s=t(r,1)>>>0;const g=d();let i=0;for(;i<r;i++){const o=e.charCodeAt(i);if(o>127)break;g[s+i]=o}if(i!==r){i!==0&&(e=e.slice(i)),s=n(s,r,r=i+e.length*3,1)>>>0;const o=d().subarray(s+i,s+r),p=z(e,o);i+=p.written,s=n(s,r,i,1)>>>0}return a=i,s}function A(e){return e==null}function U(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function h(e){const t=_.__wbindgen_export_2.get(e);return _.__externref_table_dealloc(e),t}const O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_carpengine_free(e>>>0,1));class W{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),t}free(){const t=this.__destroy_into_raw();_.__wbg_carpengine_free(t,0)}constructor(t){const n=_.carpengine_new(t);return this.__wbg_ptr=n>>>0,O.register(this,this.__wbg_ptr,this),this}perft(t,n){const r=b(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a;_.carpengine_perft(this.__wbg_ptr,r,s,n)}search(t,n){const r=b(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a,g=b(n,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a;_.carpengine_search(this.__wbg_ptr,r,s,g,i)}}const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_perftoutput_free(e>>>0,1));class m{static __wrap(t){t=t>>>0;const n=Object.create(m.prototype);return n.__wbg_ptr=t,R.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),t}free(){const t=this.__destroy_into_raw();_.__wbg_perftoutput_free(t,0)}get time(){const t=_.__wbg_get_perftoutput_time(this.__wbg_ptr);return BigInt.asUintN(64,t)}set time(t){_.__wbg_set_perftoutput_time(this.__wbg_ptr,t)}get nodes(){const t=_.__wbg_get_perftoutput_nodes(this.__wbg_ptr);return BigInt.asUintN(64,t)}set nodes(t){_.__wbg_set_perftoutput_nodes(this.__wbg_ptr,t)}get nps(){return _.__wbg_get_perftoutput_nps(this.__wbg_ptr)}set nps(t){_.__wbg_set_perftoutput_nps(this.__wbg_ptr,t)}get mov(){const t=_.__wbg_get_perftoutput_mov(this.__wbg_ptr);let n;return t[0]!==0&&(n=c(t[0],t[1]).slice(),_.__wbindgen_free(t[0],t[1]*1,1)),n}set mov(t){var n=A(t)?0:b(t,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_perftoutput_mov(this.__wbg_ptr,n,r)}asObject(){const t=_.perftoutput_asObject(this.__wbg_ptr);if(t[2])throw h(t[1]);return h(t[0])}}const j=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_score_free(e>>>0,1));class y{static __wrap(t){t=t>>>0;const n=Object.create(y.prototype);return n.__wbg_ptr=t,j.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),t}free(){const t=this.__destroy_into_raw();_.__wbg_score_free(t,0)}get val(){return _.__wbg_get_score_val(this.__wbg_ptr)}set val(t){_.__wbg_set_score_val(this.__wbg_ptr,t)}get w(){return _.__wbg_get_score_w(this.__wbg_ptr)}set w(t){_.__wbg_set_score_w(this.__wbg_ptr,t)}get d(){return _.__wbg_get_score_d(this.__wbg_ptr)}set d(t){_.__wbg_set_score_d(this.__wbg_ptr,t)}get l(){return _.__wbg_get_score_l(this.__wbg_ptr)}set l(t){_.__wbg_set_score_l(this.__wbg_ptr,t)}}const E=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_searchoutput_free(e>>>0,1));class v{static __wrap(t){t=t>>>0;const n=Object.create(v.prototype);return n.__wbg_ptr=t,E.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),t}free(){const t=this.__destroy_into_raw();_.__wbg_searchoutput_free(t,0)}get time(){const t=_.__wbg_get_searchoutput_time(this.__wbg_ptr);return BigInt.asUintN(64,t)}set time(t){_.__wbg_set_searchoutput_time(this.__wbg_ptr,t)}get nodes(){const t=_.__wbg_get_searchoutput_nodes(this.__wbg_ptr);return BigInt.asUintN(64,t)}set nodes(t){_.__wbg_set_searchoutput_nodes(this.__wbg_ptr,t)}get nps(){return _.__wbg_get_searchoutput_nps(this.__wbg_ptr)}set nps(t){_.__wbg_set_searchoutput_nps(this.__wbg_ptr,t)}get depth(){return _.__wbg_get_searchoutput_depth(this.__wbg_ptr)>>>0}set depth(t){_.__wbg_set_searchoutput_depth(this.__wbg_ptr,t)}get score_type(){return _.__wbg_get_searchoutput_score_type(this.__wbg_ptr)}set score_type(t){_.__wbg_set_searchoutput_score_type(this.__wbg_ptr,t)}get score(){const t=_.__wbg_get_searchoutput_score(this.__wbg_ptr);return y.__wrap(t)}set score(t){U(t,y);var n=t.__destroy_into_raw();_.__wbg_set_searchoutput_score(this.__wbg_ptr,n)}get pv(){let t,n;try{const r=_.__wbg_get_searchoutput_pv(this.__wbg_ptr);return t=r[0],n=r[1],c(r[0],r[1])}finally{_.__wbindgen_free(t,n,1)}}set pv(t){const n=b(t,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_searchoutput_pv(this.__wbg_ptr,n,r)}asObject(){const t=_.searchoutput_asObject(this.__wbg_ptr);if(t[2])throw h(t[1]);return h(t[0])}}async function M(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function I(){const e={};return e.wbg={},e.wbg.__wbg_call_d7f1c46e45eb4f4a=function(){return w(function(t,n){return t.call(n)},arguments)},e.wbg.__wbg_globalThis_e08c4751c8a1f1d7=function(){return w(function(){return globalThis.globalThis},arguments)},e.wbg.__wbg_global_75ca36ecbc609a1a=function(){return w(function(){return global.global},arguments)},e.wbg.__wbg_new_8e8bc408f9c499ad=function(){return new Object},e.wbg.__wbg_newnoargs_5e2de9fa77069cf6=function(t,n){return new Function(c(t,n))},e.wbg.__wbg_now_2c95c9de01293173=function(t){return t.now()},e.wbg.__wbg_performance_7a3ffd0b17f663ad=function(t){return t.performance},e.wbg.__wbg_self_0cfbda1f4efc008f=function(){return w(function(){return self.self},arguments)},e.wbg.__wbg_set_3f1d0b984ed272ed=function(t,n,r){t[n]=r},e.wbg.__wbg_updateenginepick_4d13d4e7876b75bc=function(t,n){update_engine_pick(c(t,n))},e.wbg.__wbg_updateperftdata_c0d88e2d68289041=function(t){update_perft_data(m.__wrap(t))},e.wbg.__wbg_updatesearchdata_cb9751ef2d716c32=function(t){update_search_data(v.__wrap(t))},e.wbg.__wbg_window_b233edd9d0681fe0=function(){return w(function(){return window.window},arguments)},e.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},e.wbg.__wbindgen_error_new=function(t,n){return new Error(c(t,n))},e.wbg.__wbindgen_init_externref_table=function(){const t=_.__wbindgen_export_2,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_is_undefined=function(t){return t===void 0},e.wbg.__wbindgen_number_new=function(t){return t},e.wbg.__wbindgen_string_new=function(t,n){return c(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(c(t,n))},e}function S(e,t){return _=e.exports,x.__wbindgen_wasm_module=t,u=null,_.__wbindgen_start(),_}async function x(e){if(_!==void 0)return _;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/assets/carp_wasm_bg-YT-cjl_H.wasm",self.location.href));const t=I();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await M(await e,t);return S(n,r)}let f=null;self.update_perft_data=e=>{self.postMessage({type:"perftResult",data:e.asObject()})},self.update_search_data=e=>{self.postMessage({type:"searchResult",data:e.asObject()})},self.update_engine_pick=e=>{self.postMessage({type:"enginePick",data:e})},self.onmessage=async e=>{const{type:t,data:n,module:r}=e.data;if(t==="init")r?await x(r):await x(),f=new W(256),self.postMessage({type:"ready"});else if(t==="search"&&f){const{position:s,tc:g}=n;f.search(s,g)}else if(t==="perft"&&f){const{position:s,depth:g}=n;f.perft(s,g)}}})();
