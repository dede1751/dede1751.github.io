(function(){"use strict";let n;const O=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&O.decode();let p=null;function f(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(n.memory.buffer)),p}function g(e,t){return e=e>>>0,O.decode(f().subarray(e,e+t))}let c=0;const d=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},x=typeof d.encodeInto=="function"?function(e,t){return d.encodeInto(e,t)}:function(e,t){const _=d.encode(e);return t.set(_),{read:e.length,written:_.length}};function b(e,t,_){if(_===void 0){const o=d.encode(e),u=t(o.length,1)>>>0;return f().subarray(u,u+o.length).set(o),c=o.length,u}let r=e.length,s=t(r,1)>>>0;const a=f();let i=0;for(;i<r;i++){const o=e.charCodeAt(i);if(o>127)break;a[s+i]=o}if(i!==r){i!==0&&(e=e.slice(i)),s=_(s,r,r=i+e.length*3,1)>>>0;const o=f().subarray(s+i,s+r),u=x(e,o);i+=u.written,s=_(s,r,i,1)>>>0}return c=i,s}function E(e){return e==null}function T(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function l(e){const t=n.__wbindgen_export_0.get(e);return n.__externref_table_dealloc(e),t}const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>n.__wbg_carpengine_free(e>>>0,1));class A{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),t}free(){const t=this.__destroy_into_raw();n.__wbg_carpengine_free(t,0)}constructor(){const t=n.carpengine_new();return this.__wbg_ptr=t>>>0,R.register(this,this.__wbg_ptr,this),this}reset(){n.carpengine_reset(this.__wbg_ptr)}resize_tt(t){n.carpengine_resize_tt(this.__wbg_ptr,t)}perft(t,_){const r=b(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=c;n.carpengine_perft(this.__wbg_ptr,r,s,_)}search(t,_){const r=b(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=c,a=b(_,n.__wbindgen_malloc,n.__wbindgen_realloc),i=c;n.carpengine_search(this.__wbg_ptr,r,s,a,i)}}const z=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>n.__wbg_perftoutput_free(e>>>0,1));class y{static __wrap(t){t=t>>>0;const _=Object.create(y.prototype);return _.__wbg_ptr=t,z.register(_,_.__wbg_ptr,_),_}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,z.unregister(this),t}free(){const t=this.__destroy_into_raw();n.__wbg_perftoutput_free(t,0)}get time(){const t=n.__wbg_get_perftoutput_time(this.__wbg_ptr);return BigInt.asUintN(64,t)}set time(t){n.__wbg_set_perftoutput_time(this.__wbg_ptr,t)}get nodes(){const t=n.__wbg_get_perftoutput_nodes(this.__wbg_ptr);return BigInt.asUintN(64,t)}set nodes(t){n.__wbg_set_perftoutput_nodes(this.__wbg_ptr,t)}get nps(){return n.__wbg_get_perftoutput_nps(this.__wbg_ptr)}set nps(t){n.__wbg_set_perftoutput_nps(this.__wbg_ptr,t)}get mov(){const t=n.__wbg_get_perftoutput_mov(this.__wbg_ptr);let _;return t[0]!==0&&(_=g(t[0],t[1]).slice(),n.__wbindgen_free(t[0],t[1]*1,1)),_}set mov(t){var _=E(t)?0:b(t,n.__wbindgen_malloc,n.__wbindgen_realloc),r=c;n.__wbg_set_perftoutput_mov(this.__wbg_ptr,_,r)}asObject(){const t=n.perftoutput_asObject(this.__wbg_ptr);if(t[2])throw l(t[1]);return l(t[0])}}const F=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>n.__wbg_score_free(e>>>0,1));class h{static __wrap(t){t=t>>>0;const _=Object.create(h.prototype);return _.__wbg_ptr=t,F.register(_,_.__wbg_ptr,_),_}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,F.unregister(this),t}free(){const t=this.__destroy_into_raw();n.__wbg_score_free(t,0)}get val(){return n.__wbg_get_score_val(this.__wbg_ptr)}set val(t){n.__wbg_set_score_val(this.__wbg_ptr,t)}get w(){return n.__wbg_get_score_w(this.__wbg_ptr)}set w(t){n.__wbg_set_score_w(this.__wbg_ptr,t)}get d(){return n.__wbg_get_score_d(this.__wbg_ptr)}set d(t){n.__wbg_set_score_d(this.__wbg_ptr,t)}get l(){return n.__wbg_get_score_l(this.__wbg_ptr)}set l(t){n.__wbg_set_score_l(this.__wbg_ptr,t)}}const j=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>n.__wbg_searchoutput_free(e>>>0,1));class m{static __wrap(t){t=t>>>0;const _=Object.create(m.prototype);return _.__wbg_ptr=t,j.register(_,_.__wbg_ptr,_),_}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),t}free(){const t=this.__destroy_into_raw();n.__wbg_searchoutput_free(t,0)}get time(){const t=n.__wbg_get_searchoutput_time(this.__wbg_ptr);return BigInt.asUintN(64,t)}set time(t){n.__wbg_set_searchoutput_time(this.__wbg_ptr,t)}get nodes(){const t=n.__wbg_get_searchoutput_nodes(this.__wbg_ptr);return BigInt.asUintN(64,t)}set nodes(t){n.__wbg_set_searchoutput_nodes(this.__wbg_ptr,t)}get nps(){return n.__wbg_get_searchoutput_nps(this.__wbg_ptr)}set nps(t){n.__wbg_set_searchoutput_nps(this.__wbg_ptr,t)}get depth(){return n.__wbg_get_searchoutput_depth(this.__wbg_ptr)>>>0}set depth(t){n.__wbg_set_searchoutput_depth(this.__wbg_ptr,t)}get score_type(){return n.__wbg_get_searchoutput_score_type(this.__wbg_ptr)}set score_type(t){n.__wbg_set_searchoutput_score_type(this.__wbg_ptr,t)}get score(){const t=n.__wbg_get_searchoutput_score(this.__wbg_ptr);return h.__wrap(t)}set score(t){T(t,h);var _=t.__destroy_into_raw();n.__wbg_set_searchoutput_score(this.__wbg_ptr,_)}get pv(){let t,_;try{const r=n.__wbg_get_searchoutput_pv(this.__wbg_ptr);return t=r[0],_=r[1],g(r[0],r[1])}finally{n.__wbindgen_free(t,_,1)}}set pv(t){const _=b(t,n.__wbindgen_malloc,n.__wbindgen_realloc),r=c;n.__wbg_set_searchoutput_pv(this.__wbg_ptr,_,r)}asObject(){const t=n.searchoutput_asObject(this.__wbg_ptr);if(t[2])throw l(t[1]);return l(t[0])}}async function W(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const _=await e.arrayBuffer();return await WebAssembly.instantiate(_,t)}else{const _=await WebAssembly.instantiate(e,t);return _ instanceof WebAssembly.Instance?{instance:_,module:e}:_}}function U(){const e={};return e.wbg={},e.wbg.__wbg_getTime_cab825bc49cad8b6=function(t){return t.getTime()},e.wbg.__wbg_new0_fc71fa616199ed4c=function(){return new Date},e.wbg.__wbg_new_8e8bc408f9c499ad=function(){return new Object},e.wbg.__wbg_set_3f1d0b984ed272ed=function(t,_,r){t[_]=r},e.wbg.__wbg_updateenginepick_9a5ecf7e4a8dbe26=function(t,_){update_engine_pick(g(t,_))},e.wbg.__wbg_updateperftdata_0fa1afa275d07539=function(t){update_perft_data(y.__wrap(t))},e.wbg.__wbg_updatesearchdata_1261c5555cbbeaa1=function(t){update_search_data(m.__wrap(t))},e.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},e.wbg.__wbindgen_error_new=function(t,_){return new Error(g(t,_))},e.wbg.__wbindgen_init_externref_table=function(){const t=n.__wbindgen_export_0,_=t.grow(4);t.set(0,void 0),t.set(_+0,void 0),t.set(_+1,null),t.set(_+2,!0),t.set(_+3,!1)},e.wbg.__wbindgen_number_new=function(t){return t},e.wbg.__wbindgen_string_new=function(t,_){return g(t,_)},e.wbg.__wbindgen_throw=function(t,_){throw new Error(g(t,_))},e}function I(e,t){return n=e.exports,v.__wbindgen_wasm_module=t,p=null,n.__wbindgen_start(),n}async function v(e){if(n!==void 0)return n;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/assets/carp_wasm_bg-DIWw2oFb.wasm",self.location.href));const t=U();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:_,module:r}=await W(await e,t);return I(_,r)}let w=null;self.update_perft_data=e=>{self.postMessage({type:"perftResult",data:e.asObject()})},self.update_search_data=e=>{self.postMessage({type:"searchResult",data:e.asObject()})},self.update_engine_pick=e=>{self.postMessage({type:"enginePick",data:e})},self.onmessage=async e=>{const{type:t,data:_,module:r}=e.data;if(t==="init")r?await v(r):await v(),w=new A,w.resize_tt(64),self.postMessage({type:"ready"});else if(t==="search"&&w){const{position:s,tc:a}=_;w.search(s,a)}else if(t==="perft"&&w){const{position:s,depth:a}=_;w.perft(s,a)}}})();
